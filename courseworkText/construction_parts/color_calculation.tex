\section{Разделение луча} {
    Рассматривается следующая ситуация: луч падает на точку объекта,
    разделяясь на преломлённый и отражённый.
    Сначала необходимо определить способ поиска
    направления отражённого и преломлённого лучей.
    Пусть:
    \begin{itemize}
        \item $\vec{n}$ -- направление отражённого луча;
        \item $\vec{r}$ -- направление преломлённого луча;
        \item $\vec{R}$ -- направление отражённого луча;
        \item $\vec{T}$ -- направление луча после преломления.
    \end{itemize}
    Тогда выполнены равенства \ref{f:R} и \ref{f:T}:
    \begin{equation}
        \label{f:R}
        \vec{R} = [\vec{n} \times [\vec{r} \times \vec{n}]]
    \end{equation}
    \begin{equation}
        \label{f:T}
        \vec{T} = R \cdot \frac{k_1}{k_2}
        \cdot (\vec{R}; \vec{r}) - \vec{n} \cdot
        \sqrt{ 1 - (\frac{k_1}{k_2} \cdot (\vec{R}; \vec{r}))^2 }
    \end{equation}
    Эти методы основаны на аналитической геометрии~[11].
    
    Яркость луча определяется интенсивностью красной, зелёной и синей составляющих,
    каждая из которых может быть вещественным числом.
    Интенсивность света, достигшая объекта, вычисляется для каждой составляющей
    по отдельности.
    Для реализации трассировки необходимо реализовать алгоритм распределения
    интенсивности света между отражённым и преломлённым лучами.
    Этот алгоритм должен удовлетворять следующему условию, следующему
    из физических соображений: от объекта не может отразиться луч с составляющей
    яркости большей соответствующей составляющей цвета объекта.
    Пусть:
    \begin{itemize}
        \item
            $k_t, k_d, k_s$ -- коэффициенты пропускания,
            диффузного и зеркального отражения соответственно,
            причём $k_t + k_d + k_r = 1$;
        \item $c$ -- какая-либо составляющая цвета объекта;
        \item
            $r$ -- яркость соответствующей составляющей цвета луча,
            первоначально она равна $0$;
        \item
            $w$ -- произведение коэффициентов отражения или пропускания
            всех предыдущих точек столкновения луча с объектами.
    \end{itemize}
    Далее представлены шаги алгоритма для одной составляющей яркости:
    \begin{itemize}
        \item
            с помощью $k_d$ вычисляется суммарная яркость $\alpha$,
            достигшая точки объекта от всех источников;
        \item вычисляется яркость пропущенного луча: $x_t := \alpha \cdot k_t$;
        \item
            вычисляется яркость отражённого луча:
            $x_r := r + w \cdot min(\alpha - x_t$, $c)$.
    \end{itemize}
    В результате составляющие яркости падающего луча распределяются
    между преломлённым и отражённым лучами.
    Итоговый цвет, который увидит наблюдатель в данной точке, вычисляется
    как среднее арифметическое из цветов лучей, на которые распался данный.
}