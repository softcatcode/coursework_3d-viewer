\section{Проблема алгоритма затенения и её решение} {
    Пусть поставлена задача расчёта яркости точки сцены $P$ с помощью
    выбранного алгоритма затенения.
    Существует особенность алгоритма расчёта яркости, усложняющая
    его реализацию.
    Пусть уже построен буфер источника $buf$.
    С помощью матрицы перехода к координатам источника можно найти позицию
    $(i, j)$ элемента $elem$ буфера $buf$, куда проецируется точка $P$.
    Но одному элементу $elem$ может соответствовать целое множество
    точек сцены.
    То есть при построении буфера источника в элементе $elem$ могла быть
    сохранена информация о точке $P'$, находящейся вблизи $P$.
    Таким образом, то, что глубина точки $P$ относительно источника
    меньше глубины, сохранённой в elem, не гарантирует, что $P$ не освещена.
    Тогда нужно ввести специальную метрику для правильного сравнения глубин.
    Далее описан способ сравнения глубины $d_P$ точки $P$ относительно
    источника и значения глубины $d$, хранящегося в буфере.
    Пусть $\vec{n}(n_x, n_y, n_z)$ -- внешняя нормаль к поверхности объекта
    в точке $P$.
    Освещние производится по оси z источника.
    Размерность одного элемента буфера соответствует 1 единичному отрезку,
    что следует из принципа заполнения этого буфера: перебираются точки
    проекции граней на $(xy)$ с целочистенными координатами.
    Поэтому $\delta d = 1 / ctan(\alpha)$,
    где $\delta d$ -- точность сравнения глубин, а $\alpha$ --
    угол между $\vec{n}$ и плоскостью $(xy)$.
    Но $ctg(\alpha) = \sqrt{\frac{1}{\sin^2(\alpha)} - 1} =
    \sqrt{\frac{1}{z_n^2} - 1}$
    В результате точка $P$ считается освещённой,
    если $|d - d_P| < \delta d$.
}