\chapter{Технологическая часть}
\section {Средства реализации} {
    Для реализации программы использован язык c++.
    А генерация кадра реализована с помощью библиотеки cinder.
    Она предоставляет 3 функции для процесса отрисовки:
    <<setup>>, <<update>> и <<draw>> для инициализации алгоритма визуализации,
    обновления кадра и отрисовки изображения соответственно.
    Замеры времени выполнения выполнялись с помощью библиотеки ctime.
    
    Далее описаны типы данных программы:
    \begin{itemize}
        \item вектор и точка -- 3 вещественных координаты $(x, y, z)$;
        \item цвет -- целочисленные составляющие красного, зелёного и синего.
        \item матрица $3 \times 3$ -- совокупность 3 векторов;
        \item изображение -- матрица цветов;
        \item сфера -- точка и радиус;
        \item сегмент луча -- точка и вектор направления распространения луча.
    \end{itemize}
    
    Для реализации данных тпов использованы следующие структуры:
    \begin{itemize}
        \item вектор и точка -- vec3;
        \item цвет -- Color.
        \item матрица $3 \times 3$ -- mat3;
        \item изображение -- Surface;
        \item сфера -- Sphere;
        \item сегмент луча -- Ray.
    \end{itemize}
}

\section{Сведения о модулях программы} {
        Каждый файл представлен в 2 экземплярах:
        с расширениями <<.hpp>> и <<.cpp>>, где содержится
        интерфейс и его реализация соответственно.
        Список имён файлов программы с кратким описанием их назначения:
        \begin{itemize}
            \item logs -- логирование;
            \item beam -- логика обработки пучка лучей;
            \item beamsegment -- логика обработки сегмента луча;
            \item brightness -- функции расчёта яркости;
            \item collision -- структура, описывающая столкновение
            луча с объектом и логика его поиска;
            \item controller -- функции обработки кнопок;
            \item drawutils -- функции отрисовки изображения;
            \item interfacemanager -- точка входа в обработку запросов
            на иницилизацию, обновление и отрисовку;
            \item interfacemanagerimpl -- реализация обработки запросов
            иницилизации, обновления и отрисовки;
            \item ioutils -- ввод и вывод сцены из файла;
            \item keyrespond -- точка входа в логику отклика
            на нажатие кнопки на клавиатуре;
            \item mathutils -- математические незацисимые функции;
            \item objproperties -- структкра, хранащая свойства объекта;
            \item operationmanager -- точка входа в логику обработки запроса
            на выполнение следующего этапа алгоритма визуализации;
            \item raytracer -- структура и логика иницилизации трассировщика лучей и функция трассировки;
            \item rsmelem -- логика обработки элемента буфера источника;
            \item shadowmap -- структура буфера источника света
            и логика её построения;
            \item stage -- структура сцены и функции для её обработки;
            \item stageobj -- структуры объектов сцены и функции их
            обработки;
            \item tracing -- логика трассировки и разделения луча
            на преломлённый и отражённый.
        \end{itemize}
        
        Также присутствуют следующие файлы:
        \begin{itemize}
            \item <<parameters.hpp>> -- файл с параметрами;
            \item <<viewer3d.hpp>> -- интерфейс объекта приложения;
            \item <<Viewer3DApp.cpp>> -- реализация интерфейса
            \item <<drawalgodata.hpp>> -- структура, содержащая всё
            необходимое для процесса генерации кадра;
            объекта приложения.
        \end{itemize}
    }

\section{Реализация алгоритмов} {
    В листинге \ref{lst:structures} предсавлены объявления структур данных.
    \lstinputlisting[
        label=lst:structures,
        caption=Объявление структур программы.
    ] {./code/structures.cpp}
    
    В листинге \ref{lst:buildShadowMaps} представлена реализация алгоритма
    построения буферов теней, а в листингах \ref{lst:rsm}-\ref{lst:fong} --
    алгоритмы расчёта яркости точки.
    \lstinputlisting[
        label=lst:buildShadowMaps,
        caption=Реализация построения буферов теней.
    ] {./code/shadowing/buildShadowMaps.cpp}

    \lstinputlisting[
        label=lst:rsm,
        caption=
            Реализация вычисления яркости в алгоритме
            с отражательной картой теней.
    ] {./code/shadowing/rsmBrightness.cpp}
        
    \lstinputlisting[
        label=lst:trace,
        caption=Реализация вычисления яркости с помощью трассировки.
    ] {./code/shadowing/traceBrightness.cpp}

    \lstinputlisting[
        label=lst:fong,
        caption=Реализация вычисления яркости с помощью модели Фонга.
    ] {./code/shadowing/fongBrightness.cpp}

    В листинге \ref{lst:split} приведена реализация разбиения луча на 2
    в результате столкновения с препятствием.
    \lstinputlisting[
        label=lst:split,
        caption=Реализация разбиения луча на преломлённый и отражённый.
    ] {./code/tracing/split.cpp}

    В листинге \ref{lst:trace} представлена реализация алгоритма получения
    изображения с помощью трассировки.
    \lstinputlisting[
        label=lst:trace,
        caption=Реализация разбиения луча на преломлённый и отражённый.
    ] {./code/tracing/trace.cpp}

    В листинге \ref{lst:findNextCollision} представлена реализация алгоритма нахождения
    столкновения луча и объекта с помощью построения сфер.
    \lstinputlisting[
        label=lst:findNextCollision,
        caption=Реализация функции нахождения координат столкновения луча и объекта.
    ] {./code/tracing/findNextCollision.cpp}
}

\section*{Выводы}
В результате данного раздела с помощью структурного программирования
была разработана программа для визуализации объектов.
Также описаны средства реализации и предоставлены сведения о файлах
программы.